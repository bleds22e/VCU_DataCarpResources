---
title: 'Module 3: Data Visualization'
author: "Ellen Bledsoe"
date: '2022-10-18'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# A Visualization Primer

Some figures to whet your palate:\
<http://www.r-graph-gallery.com/19-map-leafletr/>\
<http://www.r-graph-gallery.com/21-distribution-plot-using-ggplot2>\
<http://www.r-graph-gallery.com/274-map-a-variable-to-ggplot2-scatterplot/>\
<http://www.r-graph-gallery.com/123-circular-plot-circlize-package-2/>

[Here](http://paldhous.github.io/ucb/2016/dataviz/week2.html) is a decent overview of some of the core concepts of data visualization.

## Why Does Data Visualization Matter?

### On your own

Take 3 minutes to write down your top 5 reasons why data visualization is important or useful to you

### Small Groups

As a group, take 5 minutes to compare your notes and come to a group consensus on your top 5 reasons. Be sure to choose someone to report out!

## Types of Visualization

### Small group activity

In groups, discuss as many all types of visualization that come to mind. It's ok if you don't know what they are called! Make a quick list or draw them out if you prefer.

Data Visualization Types:

[Reference](https://extremepresentation.typepad.com/files/choosing-a-good-chart-09.pdf)

### Data matching activity

Still in your groups, open the PDF called "data_viz_matching_exercise"

Spend a few minutes seeing if you can match the data descriptions to the types of data visualizations. Note: these plots do not represent the data, just a type of data visualization.

This is a challenging exercise, so don't panic if you feel a little lost! Here are some things to help you think through which visualizations might be appropriate:

-   how many variables are in the data description?
-   how many variables are represented in the data visualization? Look at the axes, sizes, colors, etc.
-   how is *one* data point represented on the plot?
-   how is variation in the data represented on the plot, if at all?

#### Matches

1.  B
    -   circle plots or river plots
    -   good for showing movement from one thing to another or relationships between two categorical variables
2.  D
    -   4! variables can be shown here---circles could be size of family
    -   scatter plots are good at showing relationships between multiple *continuous* variables
3.  C
    -   Multiple samples for each treatment means we will want to show variation
    -   Variation in the multiple samples is show through violin plot; show the mean *and* the distribution of the data
    -   One categorical variable and one continuous variable
    -   Second categorical variable could be shown through color of violin plot
4.  E
    -   Heatmaps are good at showing spatial distributions of data
    -   x and y axes shows space; the color indicates continuous values
5.  A
    -   Bar plots are good for showing change through time
    -   Categorical on x, continuous on y
    -   mutliple stacks, 2 bars per year?

## Figure Critique

First, read through [this blog post](https://humansofdata.atlan.com/2019/02/dos-donts-data-visualization/) on the "Dos and Don'ts of Data Visualization"

Now that you have some insights, let's critique these figures below. Yes, these are actual figures in the wild...

-   what aspects don't work
-   what aspects do work
-   how how you present the data?

Figures:

1.  ![](https://raw.githubusercontent.com/keatonwilson/biostats/master/Images/3d-column-chart-of-awesome.png)

2.  ![](https://raw.githubusercontent.com/keatonwilson/biostats/master/Images/Bling_fig3.jpg)

3.  ![](https://raw.githubusercontent.com/keatonwilson/biostats/master/Images/cawley_fig1.jpg)

4.  ![](https://raw.githubusercontent.com/keatonwilson/biostats/master/Images/roeder_fig4.jpg)


## Plotting in `ggplot2`

Let's practice making different kinds of plots with various `geom` functions to see how they work. We can use the collar data again.

```{r}
library(tidyverse)
collars <- read_csv("../data/collar_data.csv")
```

### Scatter plot

As a reminder, we use the `geom_point()` function to make a scatter plot of the relationship between *two continuous variables*.

```{r}
ggplot(collars, aes(battery_life, signal_distance)) +
  geom_point()
```

### Histograms

As we learned last modules, histograms are plots which let us look at *one continuous variable* and get a feel for the distribution of that data. To make histograms in `ggplot2`, we use the `geom_histogram()` function. Let's look at signal distance.

```{r}
ggplot(collars, aes(signal_distance)) +
  geom_histogram(bins = 10)

# we can change the number of bins (essentially, the number of columns) by modifying the bins argument in the geom_histogram function
```

### Density plots

Density plots are similar to histograms in that they show the distribution of a *continuous variable* but they are smoothed and continuous version estimated from the data. For this class, you can think of them as being basically the same thing (and use them interchangeably).

```{r}
ggplot(collars, aes(signal_distance)) +
  geom_density()
```

What if we wanted to create a histogram for signal distance for each collar manufacturer? In base R, we would need to filter or make a new dataframe. With `ggplot2`, we can specify that we want the `color` (or the `fill`) to be determined by the maker column.

```{r}
ggplot(collars, aes(signal_distance)) +
  geom_density(aes(color = maker, fill = maker))
```

Hooray! But...we can't really see the bars for Budget Collars LLC in the lower range of the values because they are hidden behind the Collarium Inc. bars. How might we address this?

To fix this issue, we can use the `alpha` argument, which changes the transparency of the bars. The scale for `alpha` runs from 0 (completely transparent) to 1 (completely solid). Let's try 0.5.

```{r}
ggplot(collars, aes(signal_distance)) +
  geom_density(aes(fill = maker), alpha = .5)
```

### The powerful and pesky `aes()` function

A quick note about the `aes()` function. It's one of the more confusing bits of `ggplot2`.

When do I put the `color` (or `size` or `linetype` or `fill` or whatever) inside the `aes()` function versus in the `geom` function but outside of `aes()`? When we made our density plots, why did the `color` argument go inside of `aes()` but `alpha` went outside?

Essentially, it boils down to this:

-   if you want something (color, size, etc.) on your plot to change based on a **variable** from a data frame, you will want to put the argument *within* the `aes()` function.

-   if you want something (color, size, etc.) on the plot to be **constant**, you will specify it *outside* of the function.

For some additional examples and explanation, check out [this Stack Overflow page](https://stackoverflow.com/questions/41863049/when-does-the-argument-go-inside-or-outside-aes).

### Bar plot

Let's make a bar plot! They are typically used to represent the counts of *one categorical* variable or the relationship between *one categorical and one continuous variable*. We use the `geom_col` function.

For our example, we can make a bar plot of the number of collars which failed and which did not.

```{r}

fails <- collars %>% 
  group_by(maker, fail) %>% 
  count()
fails
  
ggplot(fails, aes(fail, n)) +
  geom_col(aes(fill = maker))
```

What we just made is something called a "stacked" bar plot, meaning the values for the two collar makers are stacked one on top of the other. If we wanted them side-by-side, we add the argument `position = "dodge"`.

```{r}
ggplot(fails, aes(fail, n, fill = maker)) +
  geom_col(position = "dodge")
```

## Practice

Hopefully you're excited to keep using `ggplot2` to make clean, interpretable data visualizations! With the remaining time in class, spend some time trying to recreate the plots you made in Module 2 Assignment 1. Try to recreate both histogram and the scatter plot.

```{r}
# load the tidyverse package and the penguins package

```
